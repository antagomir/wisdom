 %% unilaiva-songbook
 %% =================
 %%
 %% Collection of songs etc
 %%

\documentclass[twoside,10pt]{book}
\usepackage[finnish,english]{babel}\selectlanguage{english}

\usepackage[utf8x]{inputenc}
% Add option 'sfdefault' to use the sans serif version as default font,
% which is used in non-song texts. It takes a bit more space.

% Font weight defaults for Noto are regular and bold; here they are made heavier.
% Do not use font scaling as it messes with line spacing in some cases.
\usepackage[medium,extrabold]{noto}
\usepackage[T1]{fontenc}

\usepackage[bookmarks,unicode]{hyperref} % used by 'songs' package for index links in PDF
  \hypersetup{linkbordercolor=0.5 0.9 0.6,
              pdftitle=Unilaiva songbook,
              unicode=true}
% NOTE: * In versions before 2018-5-10 we used inner=20mm,outer=10mm,tmargin=16mm,bmargin=10mm,
%         but now the Golden Ratio rules. Old versions (before fancyheader) also used
%         headsep=5mm,headheight=3.5mm, but the result is about the same now.
%       * For the "default" printer, minimum top margin is 16mm (to print the chapter name fully)
\usepackage[a5paper,inner=16.18mm,outer=10mm,tmargin=16.18mm,bmargin=10mm,headsep=5mm,headheight=4.28mm,nofoot]{geometry} % page size + margins
\usepackage{graphicx}
\usepackage{pdfpages} % for cover page
% \usepackage[font=footnotesize]{caption}
\usepackage{array} % used at leat in Technical Information chapter
\usepackage{color}
% Disable all warnings issued by latex starting with "You have requested package..." to allow
% warningless loading of packages from subdirectories without setting environment variables
% (can be omitted, but warnings will appear):
\usepackage{silence}\WarningFilter{latex}{You have requested package}
\usepackage{ragged2e} % used to force text justification in 'explanation' env
\usepackage{enumitem} % used to modify 'description' env within 'explanation' env
\usepackage{xstring} % used for string manipulation in \newsongkey{tags}
\usepackage{fancyhdr} % for customizing headers

% The most important 'songs' package, use the version in the project tree:
\usepackage[chorded]{ext_packages/songs/songs}

\renewcommand{\familydefault}{\sfdefault} % Sets sans-serif as the default font family everywhere

% Allow further emergency stretching to fix some "overfull hbox" situations.
% See: https://www.tex.ac.uk/FAQ-overfull.html
\setlength{\emergencystretch}{3em}

\graphicspath{ {./content/img/} } % graphicx: set path to find images from

\definecolor{chordcolor}{rgb}{0.3,0,0.4} % color: use this for chords
\definecolor{mbarcolor}{rgb}{0.6,0.45,0.8} % color: use this for measure bar, was lighter: {0.8,0.7,0.9}
\definecolor{melodynotecolor}{rgb}{0.0,0.32,0.38} % color: use this for the encircled melody notes
\definecolor{verylightgray}{rgb}{0.92,0.92,0.92} % color: use this for song number bg & textnote bg (lighter gray)

\renewcommand{\snumbgcolor}{verylightgray} % songs: song number (in prelude) background color
\renewcommand{\notebgcolor}{verylightgray} % songs: \musicnote and \textnote background color
\renewcommand{\idxbgcolor}{verylightgray} % songs: index alphabet sectino background color

\songcolumns{1} % songs: number of columns per page in songs environment
\songpos{3} % songs: song same column-page-doublepage positioning aggressiveness 0-3
\noversenumbers % songs: do not display verse numbers
\newcommand{\defaultlyricfont}{\sffamily\large} % set the lyrics font style (used below)
\renewcommand{\lyricfont}{\defaultlyricfont} % songs: modify lyrics font style
% songs: modify chord font style (add color and make smaller):
\renewcommand{\printchord}[1]{\sffamily\bfseries\small\color{chordcolor}#1}
% songs: modify meter class font style (add color):
\renewcommand{\meterfont}{\color{chordcolor}\scriptsize\sffamily\upshape}
\renewcommand{\notefont}{\normalsize} % songs: modify \textnote and \musicnote font (make smaller)
\renewcommand{\idxtitlefont}{\sffamily} % songs: font used for titles in indices
\renewcommand{\idxlyricfont}{\sffamily\slshape} % songs: font for alternate (lyric) titles in indices
\renewcommand{\idxscripfont}{\sffamily\small\slshape} % songs: font used for tag (scripture) index
% songs: use same text color for music notes as for chords:
\renewcommand\musicnote[1]{\ifchorded\textnote{\color{chordcolor}#1}\fi}%
% songs: use real flat symbol instead of # for typesetting:
\renewcommand{\sharpsymbol}{\ensuremath{^\sharp}}%
% songs: change distance of chords to lyrics (needed because of font scaling)
\renewcommand{\clineparams}{
  \baselineskip=10.6pt
  \lineskiplimit=-2pt
  \lineskip=-2pt
}
% songs: set width of the vertical repetition line used in choruses etc (default: 1pt):
\setlength{\cbarwidth}{1.2pt}
% songs: make capo note smaller
\renewcommand\capo[1]{%
  \iftranscapos\transpose{#1}\else\musicnote{{\scriptsize capo #1}}\fi%
}
% songs: reduces line spacing in non-chorded lyrics by the amount the chords would take space
%        without needing to set \chordsoff; also removes measure bar lines. Commented out for
%        now:
% \setlength\baselineadj{-\baselineskip}

% \renewcommand{\chaptername}{Part} % would set chapter name to 'Part', does not work with babel
%\addto\captionsfinnish{\renewcommand\chaptername{Part}} % sets chapter name to Part when babel: finnish
\addto\captionsenglish{\renewcommand\chaptername{Part}} % sets chapter name to Part when babel: english
% \renewcommand{\thechapter}{\Alph{chapter}} %% use alphabets instead of numbers for chapters

% BEGIN setup headers using fancyhdr (similar to default "book" style)
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\rmfamily\small\thepage}
\fancyhead[LO]{\rmfamily\small\itshape{\rightmark}}
\fancyhead[RE]{\rmfamily\small\itshape{\leftmark}}
\renewcommand{\headrulewidth}{0pt}
% END setup headers using fancyhdr

% Comment the following line out if you don't want extra info shown in song preludes.
% Define it for a song by adding ex= parameter to \beginsong
% It can be used to for example indicate the origins or a language of a song.
\newcommand{\showextrainfo}{} % comment this line out if you don't want extra info shown (ex=?)

% Comment the following line out if you don't want phase info shown in song preludes.
% Define it for a song by adding ph= parameter to \beginsong
\newcommand{\showphaselist}{} % comment this line out if you don't want phase info shown (ph=?)
\newcommand{\showphaselistintoc}{} % comment this line out if you don't want phase info shown in TOC

% Comment the following line out if you don't want tag lists shown in song preludes
% Define a list of tags for a song by adding tags= parameter to \beginsong
% It is supposed to be a short list of single word tags of which an index is created.
\newcommand{\showtaglist}{} % comment this line out if you don't want tag list shown (tags=?)

\newcommand{\showmelodynotes}{} % comment this line out if you don't want the encircled melody notes


% More commands and environments; contains rewrites of some commands in the songs package.
% Depends on some of the settings (ie. colors) defined above.
\input{unilaiva-songbook-extra.tex}


% songs: create indexes
\newindex{titleidx}{idx_unilaiva-songbook_title}
\newauthorindex{authidx}{idx_unilaiva-songbook_auth}
\newscripindex{tagidx}{idx_unilaiva-songbook_tag}


\begin{document}

  \begin{titlepage}
    \includepdf[]{content/img/COVER.pdf} % by: larva (photo + edit)
    \thispagestyle{empty}
    \topskip0pt
    \vspace*{\fill}
    \begin{center}
      \vspace{-1.05em} % align with "Contents" heading on the next page; BAD for different page sizes!
      \Huge Unilaiva songbook\\
      \normalsize \textit{paths to higher knowledge}\\
      \Large
      \vspace{3em}
      \large By:\\
      \Large \textbf{humankind}\\
      \vspace{1em}
      \large Version:\\
      \Large \the\year-\ifnum\month<10 0\fi\the\month-\ifnum\day<10 0\fi\the\day\hspace{0.34em}$\beta$
      \\
      \vspace*{\fill}
      % Created with: qrencode -s 16 -l M -o content/img/QR_https_unilaiva_aavalla_net.png "https://unilaiva.aavalla.net/"
      \includegraphics[width=0.25\textwidth]{QR_https_unilaiva_aavalla_net.png}
      \\
      {\small\url{https://unilaiva.aavalla.net/}}
      \\
      \vspace*{\fill}
      {\footnotesize Compiled by: antagomir \& larva (\href{mailto:lari.natri@iki.fi}{lari.natri@iki.fi})}
      \\
      \vspace{1.5em}
      {\scriptsize
        The material in this book is collected from various sources over time.\\
        \vspace{-1em} % workaround for too large line spacing
        This is a work in progress, and made for the contributors' private use.
        \vspace{-1em} % workaround for too large line spacing
      }
    \end{center}
  \end{titlepage}

  \tableofcontents

  % Removes the overlapping page number in the bottom of the first TOC page:
  \addtocontents{toc}{\protect\thispagestyle{empty}}
  % Adds text "Page" on top of the TOC:
  \addtocontents{toc}{~\hfill\textbf{Page}\par}

  % The following image is to be displayed with width=1\textwidth, when the
  % TOC ends on an even (verso) page. Also uncomment the \clearpage macro in
  % such a case. The idea is to show an image on the recto page rather than
  % an empty page, because the next chapter starts on verso page. Note that
  % this page is quite prominent, so choose the possible image carefully.
  % If the TOC ends on an odd (recto) page, the width of this image is to be
  % made smaller (0.618\textwidth or 0.382\textwidth) so that it fits on that
  % same recto page, or the image can be omitted completely, if there is no
  % space for it, by commenting out the whole \begin{center}...\end{center}
  % block and also  the \clearpage macro before it.
  %\clearpage % this line is needed only when TOC ends on an even page
  \begin{center}%
    \vspace*{\fill}%
    % Original downloaded from: ?
    % Edited by: larva
    % License: Creative Commons CC0 (public domain)
    \includegraphics[width=0.382\textwidth]{shamanic_mandala_bw_ed_by_larva_CC0_1400px.jpg}
    \vspace*{\fill}%
  \end{center}

  \clearpage\scleardpage
  \songchapter{Saṃskṛtam}
     \section{About mantras}
       \input{content/section_mantra_explanation.tex}
     \clearpage\scleardpage
    \section{Hindu Bhajans \& Mantras}
      \begin{songs}{titleidx,authidx,tagidx}
        \setcounter{songnum}{100}
        \input{content/songs_sanskrit_hindu.tex}
      \end{songs}
     \scleardpage
    \section{Tibetan Buddhist Mantras}
      \begin{songs}{titleidx,authidx,tagidx}
        \setcounter{songnum}{150}
        \input{content/songs_sanskrit_buddhist.tex}
      \end{songs}

  \clearpage\scleardpage
  \songchapter{English}
    \begin{songs}{titleidx,authidx,tagidx}
      \setcounter{songnum}{200}
      \input{content/songs_english.tex}
    \end{songs}

  \clearpage\scleardpage
  \songchapter{Español}
    \begin{songs}{titleidx,authidx,tagidx}
      \setcounter{songnum}{300}
      \input{content/songs_spanish.tex}
    \end{songs}

  \clearpage\scleardpage
  \songchapter{Português}
    \begin{songs}{titleidx,authidx,tagidx}
      \setcounter{songnum}{400}
      \input{content/songs_portuguese.tex}
    \end{songs}

  \clearpage\scleardpage
  \songchapter{Other}
    \begin{songs}{titleidx,authidx,tagidx}
      \setcounter{songnum}{500}
      \input{content/songs_other.tex}
    \end{songs}

  \clearpage\scleardpage
  \songchapter{Suomi}
    \begin{otherlanguage}{finnish} % set language to finnish for hyphenation etc
      \section{Lauluja}
        \begin{songs}{titleidx,authidx,tagidx}
          \setcounter{songnum}{600}
          \input{content/songs_suomi.tex}
          % larva's scribblings (remove later?):
          \input{content/songs_suomi_larva.tex}
        \end{songs}
      \clearpage\scleardpage
      \section{Muinaissuomalaista mytologiaa}
        \input{content/section_suomi_mytologiaa.tex}
      \clearpage\scleardpage
      \section{Runoja, loitsuja}
        \begin{songs}{titleidx,authidx,tagidx}
          \setcounter{songnum}{700}
          \chordsoff % songs: do not show (empty line for non-existing) chords
          \renewcommand{\lyricfont}{\small} % songs: use smaller font
          \songcolumns{2} % songs: two columns per page
          \songpos{1} % songs: avoid ONLY page-turns within songs
          % songs: make penalty for breaking column/page at any line of lyrics to be the same:
          % (The default for \interlinepenalty is 1000, and for all the others 200.)
          \interlinepenalty=200 %
          \input{content/songs_suomi_runoja_loitsuja.tex}
          \interlinepenalty=1000 % songs: back to the default: avoid breaks within verses the most
          \songpos{3} % songs: back to the default: avoid all breaks whenever possible
          \songcolumns{1} % songs: back to the default: one column per page
          \renewcommand{\lyricfont}{\defaultlyricfont} % songs: back to the default font
          \chordson % songs: back to the default: show chords
        \end{songs}
    \end{otherlanguage}

  \clearpage%\scleardpage
  \songchapter{Technical information}
    \input{content/section_technical_information.tex}

  \clearpage
  \showindex[2]{Song Index}{titleidx} % song title index
  % \showindex{Author Index}{authidx} % song author index
  \showindex[2]{Tag Index}{tagidx} % tags index

\end{document}
